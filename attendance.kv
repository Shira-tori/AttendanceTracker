#:kivy 2.1
#:import FallOutTransition kivy.uix.screenmanager.FallOutTransition
#:import Window kivy.core.window.Window
#:import ScrollEffect kivy.effects.scroll.ScrollEffect
#:import ZBarCam kivy_garden.zbarcam.ZBarCam
#:import ZBarSymbol pyzbar.pyzbar.ZBarSymbol
#:import Builder kivy.lang.Builder
#:import Clock kivy.clock.Clock

<LoginScreen>:
	username: username
	password: password
	floatLayout: float_layout
	loginButton: loginButton
	transition: FallOutTransition()
	student_radio_button: student_radio_button
	teacher_radio_button: teacher_radio_button
	id: login_screen
	name: "login_screen"
	MDFloatLayout:
		id: float_layout
		canvas:
			Color:
				rgba: 11/255, 26/255, 45/255, 1	
			Rectangle:
				pos: self.pos
				size: self.size
				source: "imgs/bg2.jpg"
		MDLabel:
			text: "Welcome!"
			halign: "center"
			font_size: 35
			font_name: "fonts/Muli-Bold"
			theme_text_color: "Custom"
			text_color: "#FCCB01"
			pos_hint: {"center_y": .8}
		MDLabel:
			text: "Log in to your account"
			font_size: 20
			font_name: "fonts/Muli-Bold"
			theme_text_color: "Custom"
			text_color: "#BFDFF5" 
			halign: "center"
			pos_hint: {"center_y": .73}
		MDCheckbox:
			id: student_radio_button
			group: 'group'
			color_inactive: "#BFDFF5"
			color_active: "#FCCB01"
			pos_hint: {"center_x": .142, "center_y": .63}
			size_hint: None, None
			size: "45dp", "45dp"
		MDLabel:
			text: "Student"
			pos_hint: {"x": .170, "center_y": .63}
			theme_text_color: "Custom"
			text_color: "#BFDFF5"
			font_name: "fonts/Muli-Bold"
			padding_x: 5
		MDCheckbox:
			id: teacher_radio_button
			group: "group"
			color_inactive: "#BFDFF5"
			color_active: "#FCCB01"
			pos_hint: {"center_x": .70, "center_y": .63}
			size_hint: None, None
			size: "45dp", "45dp"
			active: True
		MDLabel:
			text: "Teacher"
			pos_hint: {"x": .728, "center_y": .63}
			theme_text_color: "Custom"
			font_name: "fonts/Muli-Bold"
			text_color: "#BFDFF5"
			padding_x: 5
		MDTextField:
			id: username
			hint_text: "Username"
			hint_text_color_normal: "#BFDFF5"
			line_color_normal: "#BFDFF5"
			mode: "rectangle"
			size_hint_x: .75
			theme_text_color: "Custom"
			text_color_normal: "#BFDFF5"
			icon_right: "account" 
			icon_right_color_normal: "FCCB01"
			font_name_hint_text: "fonts/Muli-Bold"
			font_name: "fonts/Muli-Bold"
			pos_hint: {"center_x": .5, "center_y": .55}
		MDTextField:
			id: password
			hint_text: "Password"
			hint_text_color_normal: "#BFDFF5"
			line_color_normal: "#BFDFF5"
			mode: "rectangle"
			size_hint_x: .75
			pos_hint: {"center_x": .5, "center_y": .44}
			theme_text_color: "Custom"
			text_color_normal: "#BFDFF5"
			icon_right: "key" 
			icon_right_color_normal: "#FCCB01"
			font_name_hint_text: "fonts/Muli-Bold"
			font_name: "fonts/Muli-Bold"
			required: True
			password: True
		MDRaisedButton:
			id: loginButton
			text: "Login"
			size_hint_x: .75
			md_bg_color: "#FCCB01"
			pos_hint: {"center_x": .5, "center_y": .34}
			font_name: "fonts/Muli-Bold"
			on_release: root.login()


<StudentsUI>:
	name: "students_ui"
	id: students_ui
	MDNavigationLayout:
		MDScreenManager:
			id: students_screen_man
			MDScreen:
				id: students_ui_home
				name: "students_ui_home"
				MDBoxLayout:
					size_hint_y: 1 
					size_hint_x: 1
					orientation: "vertical"
					canvas.before:
						Color:
							rgba: 11/255, 26/255, 45/255, 1
						Rectangle:
							pos: self.pos
							size: self.size
					MDTopAppBar:
						title: "Student's Account"
						specific_text_color: "#1C4274"
						md_bg_color: "#AAE858"
						anchor_title: "center"
						left_action_items: [["menu", lambda x: students_nav_drawer.set_state("open")]]
						elevation: 3
			
					MDFloatLayout:        
						MDCard:
							ripple_behavior: True
							orientation: "vertical"
							size_hint: None, None
							size: "200dp", "180dp"
							pos_hint: {"center_x": .5, "center_y": .7}
							MDLabel:
								text: "Daily QR Code"
								theme_text_color: "Custom"
								text_color: "teal"
								font_size: 40
								font_name: "fonts/Qazz"
								bold: True
								halign: "center"
								valign: "middle"

						MDCard:
							ripple_behavior: True
							orientation: "vertical"
							size_hint: None, None
							size: "200dp", "180dp"
							pos_hint: {"center_x": .5, "center_y": .3}
							#elevation: 20
							on_release: 
								root.init_zbarcam()
							MDLabel:
								text: "QR Code Scanner"
								theme_text_color: "Custom"
								text_color: "teal"
								font_size: 40
								font_name: "fonts/Qazz"
								bold: True
								halign: "center"
								valign: "middle"
			MDScreen:
				name: "students_ui_scanner"
				id: students_ui_scanner
				on_leave: 
					scanner_boxlayout.children[0].stop()
					scanner_boxlayout.children[0].xcamera._camera._device.release()
					Clock.unschedule(root.scanning_qr, 1)
				MDBoxLayout:
					orientation: "vertical"
					id: scanner_boxlayout
					canvas:
						Color:
							rgba: .1326, .3907, .4767, 1
						Rectangle:
							pos: self.pos
							size: self.size
					MDTopAppBar:
						title: "Scanner"
						md_bg_color: "black"
						left_action_items: [["arrow-left",  lambda x: students_screen_man.switch_to(students_ui_home, direction='right')]]
						elevation: 3
					

		MDNavigationDrawer:
			id: students_nav_drawer
			opening_transition: "out_sine"
			opening_time: .6
			closing_transition: "out_sine"
			closing_time: .6
			elevation: 5
			md_bg_color: .1326, .3907, .4767, 1
			MDBoxLayout:
				orientation: "vertical"
				spacing: "8dp"
				padding: "8dp"
				MDBoxLayout:
					MDScrollView:
						MDList:
							OneLineIconListItem:
								id: home_list
								text: "Home"
								theme_text_color: "Custom"
								text_color: "black"
								divider: "Full"
								divider_color: "black"
								on_press:
									nav_drawer.set_state("close")
									root.teachers_ui_screen_manager.current = "home"

								IconLeftWidgetWithoutTouch:
									icon: "home"
							OneLineIconListItem:
								id: settings_list
								text: "Settings"
								theme_text_color: "Custom"
								text_color: "black"
								#bg_color: 1, 1, 1, 1
								divider: "Full"
								divider_color: "black"
								#size_hint_x: 1
								on_release:
									students_nav_drawer.set_state("close")
									students_screen_man.current = "Settings"
									
								IconLeftWidgetWithoutTouch:
									icon: "cog"
							OneLineIconListItem:
								id: logout_list
								text: "Logout"
								theme_text_color: "Custom"
								text_color: "black"
								#bg_color: 1, 1, 1, 1
								divider: "Full"
								divider_color: "black"
								#size_hint_x: 1
								on_release:
									root.switch_to(login_screen)	
									
								IconLeftWidgetWithoutTouch:
									icon: "logout"
				MDScrollView:
					orientation: 'vertical'
					canvas:
						Color:
							rgb: 1, 1, 1
						Ellipse:
							pos: 91, 145
							size: 146 , 146
							source: 'alsonado.jpg'
							angle_start: 0
							angle_end: 360
				MDLabel:
					text: '   ALSONADO, GEAN ANDREI'
					font_style: 'Subtitle1'
					size_hint_y: None
					height: self.texture_size[1]

				MDLabel:
					text: '   12 - ICT'
					font_style: 'Subtitle1'
					size_hint_y: None
					height: self.texture_size[1]

				MDLabel:
					text: '   136889100050'
					font_style: 'Subtitle1'
					size_hint_y: None
					height: self.texture_size[1]

<TeachersUI>:
	id: teachers_ui
	name: "teachers_ui"
	MDNavigationLayout:
		canvas:
			Color:
				rgba: .1326, .3907, .4767, 1
			Rectangle:
				pos: self.pos
				size: self.size
		MDScreenManager:
			id: teachers_ui_screen_manager
			MDScreen:
				name: "home"
				id: teachers_home_screen
				MDBoxLayout:
					orientation: "vertical"
					MDTopAppBar:
						title: "Home"
						set_bars_color: True
						use_overflow: True
						font_name: "fonts/Muli-Bold"
						pos_hint: {"top": 1}
						adaptive_height: True
						adaptive_width: True
						md_bg_color: "black"
						elevation: 5
						left_action_items: [['menu', lambda x: nav_drawer.set_state("open")]]
					MDTabs:
						specific_text_color: 1, 1, 1, 1
						background_color: "black"
						tab_indicator_type: "line"
						adaptive_width: True
						adaptive_height: True
						indicator_color: 1, 1, 1, 1
						ripple_duration: 2
						tab_hint_x: True
						underline_color: 92/255, 92/255, 92/255, 1
						elevation: 5
						Tab:
							allow_stretch: True				    
							title: "Home"
							icon: "home"
							font_name: "fonts/Muli-Bold"
							MDFloatLayout:
								MDCard:
									ripple_behaviour: True
									orientation: "vertical"
									size_hint: None, None
									size: "280dp", "200dp"
									pos_hint: {"center_x": .5, "center_y": .7}
									elevation: 5
									AsyncImage:
										id: list
										source: "list.png"
										size_hint: (.8, 1)
										keep_ratio: False
										allow_stretch: True
										#size: "140dp", "90dp"
										pos_hint: {"center_x": .5, "center_y": .5}
									MDLabel:
										size_hint: (1, 0.2)					
										text: "Grade & Sections List"
										font_name: 'fonts/Muli-Bold'
										theme_text_color: "Custom"
										text_color: "teal"
										font_size: "20dp"
										bold: True
										halign: "center"
										valign: "bottom"
								MDCard:
									ripple_behavior: True
									orientation: "vertical"							
									size_hint: None, None
									size: "280dp", "200dp"
									pos_hint: {"center_x": .5, "center_y": .25}
									elevation: 5
									
									AsyncImage:
										id: scanner
										source: "scanner.png"
										size_hint: (.8, 1)
										keep_ratio: False
										allow_stretch: True
										#size: "140dp", "90dp"
										pos_hint: {"center_x": .5, "center_y": .5}
										
									MDLabel:
										size_hint: (1, .2)
										text: "QR Code Scanner"
										font_name: "fonts/Muli-Bold"
										theme_text_color: "Custom"                       
										text_color: "teal"
										font_size: "20dp"
										bold: True
										halign: "center"
										valign: "bottom"
						Tab:
							allow_stretch: True
							title: "Notifications"
							icon: "bell"
				
		MDNavigationDrawer:
			id: nav_drawer
			opening_transition: "out_sine"
			closing_transition: "out_sine"
			elevation: 5
			md_bg_color: .1326, .3907, .4767, 1
			MDBoxLayout:
				orientation: "vertical"
				spacing: "8dp"
				padding: "8dp"
				MDBoxLayout:
					orientation: "vertical"
					MDScrollView:
						MDList:
							OneLineIconListItem:
								id: home_list
								text: "Home"
								theme_text_color: "Custom"
								text_color: "black"
								divider: "Full"
								divider_color: "black"
								on_release:
									nav_drawer.set_state("close")
									teachers_ui_screen_manager.current = "home"
								IconLeftWidgetWithoutTouch:
									icon: "home"
							OneLineIconListItem:
								id: settings_list
								text: "Settings"
								theme_text_color: "Custom"
								text_color: "black"
								#bg_color: 1, 1, 1, 1
								divider: "Full"
								divider_color: "black"
								#size_hint_x: 1
								on_press:
									nav_drawer.set_state("close")
									teachers_ui_screen_manager.current = "Settings"
									
								IconLeftWidgetWithoutTouch:
									icon: "cog"
							OneLineIconListItem:
								id: logout_list
								text: "Logout"
								theme_text_color: "Custom"
								text_color: "black"
								#bg_color: 1, 1, 1, 1
								divider: "Full"
								divider_color: "black"
								#size_hint_x: 1
								on_press:
									on_release: app.stop()
									
								IconLeftWidgetWithoutTouch:
									icon: "logout"
						

	

<ScreenMan>:
	transition: FallOutTransition()
	LoginScreen:
	StudentsUI:
